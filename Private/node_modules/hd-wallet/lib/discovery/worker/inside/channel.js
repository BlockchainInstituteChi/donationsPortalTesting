'use strict';

var cov_2hevsdeg8c = function () {
    var path = '/home/g/dev/hd-wallet/src/discovery/worker/inside/channel.js',
        hash = '643f08e9ff238ce4e58eb61ae2af0ba8ac619212',
        Function = function () {}.constructor,
        global = new Function('return this')(),
        gcv = '__coverage__',
        coverageData = {
        path: '/home/g/dev/hd-wallet/src/discovery/worker/inside/channel.js',
        statementMap: {
            '0': {
                start: {
                    line: 30,
                    column: 21
                },
                end: {
                    line: 30,
                    column: 22
                }
            },
            '1': {
                start: {
                    line: 32,
                    column: 43
                },
                end: {
                    line: 32,
                    column: 56
                }
            },
            '2': {
                start: {
                    line: 35,
                    column: 15
                },
                end: {
                    line: 35,
                    column: 25
                }
            },
            '3': {
                start: {
                    line: 36,
                    column: 4
                },
                end: {
                    line: 36,
                    column: 13
                }
            },
            '4': {
                start: {
                    line: 37,
                    column: 4
                },
                end: {
                    line: 41,
                    column: 7
                }
            },
            '5': {
                start: {
                    line: 42,
                    column: 16
                },
                end: {
                    line: 42,
                    column: 26
                }
            },
            '6': {
                start: {
                    line: 43,
                    column: 4
                },
                end: {
                    line: 58,
                    column: 7
                }
            },
            '7': {
                start: {
                    line: 44,
                    column: 8
                },
                end: {
                    line: 51,
                    column: 9
                }
            },
            '8': {
                start: {
                    line: 45,
                    column: 12
                },
                end: {
                    line: 50,
                    column: 13
                }
            },
            '9': {
                start: {
                    line: 46,
                    column: 16
                },
                end: {
                    line: 49,
                    column: 17
                }
            },
            '10': {
                start: {
                    line: 47,
                    column: 20
                },
                end: {
                    line: 47,
                    column: 29
                }
            },
            '11': {
                start: {
                    line: 48,
                    column: 20
                },
                end: {
                    line: 48,
                    column: 59
                }
            },
            '12': {
                start: {
                    line: 52,
                    column: 8
                },
                end: {
                    line: 57,
                    column: 9
                }
            },
            '13': {
                start: {
                    line: 53,
                    column: 12
                },
                end: {
                    line: 56,
                    column: 13
                }
            },
            '14': {
                start: {
                    line: 54,
                    column: 16
                },
                end: {
                    line: 54,
                    column: 25
                }
            },
            '15': {
                start: {
                    line: 55,
                    column: 16
                },
                end: {
                    line: 55,
                    column: 55
                }
            },
            '16': {
                start: {
                    line: 59,
                    column: 4
                },
                end: {
                    line: 59,
                    column: 23
                }
            },
            '17': {
                start: {
                    line: 63,
                    column: 15
                },
                end: {
                    line: 63,
                    column: 25
                }
            },
            '18': {
                start: {
                    line: 64,
                    column: 4
                },
                end: {
                    line: 64,
                    column: 13
                }
            },
            '19': {
                start: {
                    line: 65,
                    column: 4
                },
                end: {
                    line: 69,
                    column: 7
                }
            },
            '20': {
                start: {
                    line: 70,
                    column: 4
                },
                end: {
                    line: 91,
                    column: 7
                }
            },
            '21': {
                start: {
                    line: 71,
                    column: 28
                },
                end: {
                    line: 71,
                    column: 36
                }
            },
            '22': {
                start: {
                    line: 72,
                    column: 8
                },
                end: {
                    line: 87,
                    column: 11
                }
            },
            '23': {
                start: {
                    line: 73,
                    column: 12
                },
                end: {
                    line: 73,
                    column: 35
                }
            },
            '24': {
                start: {
                    line: 74,
                    column: 12
                },
                end: {
                    line: 80,
                    column: 13
                }
            },
            '25': {
                start: {
                    line: 75,
                    column: 16
                },
                end: {
                    line: 79,
                    column: 17
                }
            },
            '26': {
                start: {
                    line: 76,
                    column: 20
                },
                end: {
                    line: 78,
                    column: 21
                }
            },
            '27': {
                start: {
                    line: 77,
                    column: 24
                },
                end: {
                    line: 77,
                    column: 56
                }
            },
            '28': {
                start: {
                    line: 81,
                    column: 12
                },
                end: {
                    line: 86,
                    column: 13
                }
            },
            '29': {
                start: {
                    line: 82,
                    column: 16
                },
                end: {
                    line: 85,
                    column: 17
                }
            },
            '30': {
                start: {
                    line: 83,
                    column: 20
                },
                end: {
                    line: 83,
                    column: 29
                }
            },
            '31': {
                start: {
                    line: 84,
                    column: 20
                },
                end: {
                    line: 84,
                    column: 29
                }
            },
            '32': {
                start: {
                    line: 88,
                    column: 8
                },
                end: {
                    line: 90,
                    column: 10
                }
            },
            '33': {
                start: {
                    line: 89,
                    column: 12
                },
                end: {
                    line: 89,
                    column: 28
                }
            },
            '34': {
                start: {
                    line: 95,
                    column: 4
                },
                end: {
                    line: 95,
                    column: 50
                }
            },
            '35': {
                start: {
                    line: 99,
                    column: 4
                },
                end: {
                    line: 99,
                    column: 57
                }
            },
            '36': {
                start: {
                    line: 111,
                    column: 4
                },
                end: {
                    line: 125,
                    column: 7
                }
            },
            '37': {
                start: {
                    line: 121,
                    column: 8
                },
                end: {
                    line: 123,
                    column: 9
                }
            },
            '38': {
                start: {
                    line: 122,
                    column: 12
                },
                end: {
                    line: 122,
                    column: 32
                }
            },
            '39': {
                start: {
                    line: 124,
                    column: 8
                },
                end: {
                    line: 124,
                    column: 17
                }
            },
            '40': {
                start: {
                    line: 129,
                    column: 4
                },
                end: {
                    line: 129,
                    column: 44
                }
            },
            '41': {
                start: {
                    line: 133,
                    column: 33
                },
                end: {
                    line: 133,
                    column: 90
                }
            },
            '42': {
                start: {
                    line: 134,
                    column: 4
                },
                end: {
                    line: 134,
                    column: 56
                }
            },
            '43': {
                start: {
                    line: 138,
                    column: 4
                },
                end: {
                    line: 140,
                    column: 6
                }
            },
            '44': {
                start: {
                    line: 144,
                    column: 0
                },
                end: {
                    line: 147,
                    column: 2
                }
            },
            '45': {
                start: {
                    line: 145,
                    column: 28
                },
                end: {
                    line: 145,
                    column: 38
                }
            },
            '46': {
                start: {
                    line: 146,
                    column: 4
                },
                end: {
                    line: 146,
                    column: 30
                }
            },
            '47': {
                start: {
                    line: 149,
                    column: 16
                },
                end: {
                    line: 149,
                    column: 26
                }
            },
            '48': {
                start: {
                    line: 159,
                    column: 5
                },
                end: {
                    line: 159,
                    column: 20
                }
            },
            '49': {
                start: {
                    line: 161,
                    column: 0
                },
                end: {
                    line: 175,
                    column: 3
                }
            },
            '50': {
                start: {
                    line: 162,
                    column: 4
                },
                end: {
                    line: 174,
                    column: 5
                }
            },
            '51': {
                start: {
                    line: 163,
                    column: 8
                },
                end: {
                    line: 163,
                    column: 17
                }
            },
            '52': {
                start: {
                    line: 164,
                    column: 8
                },
                end: {
                    line: 173,
                    column: 11
                }
            },
            '53': {
                start: {
                    line: 177,
                    column: 26
                },
                end: {
                    line: 177,
                    column: 36
                }
            },
            '54': {
                start: {
                    line: 178,
                    column: 52
                },
                end: {
                    line: 178,
                    column: 77
                }
            },
            '55': {
                start: {
                    line: 180,
                    column: 0
                },
                end: {
                    line: 185,
                    column: 3
                }
            },
            '56': {
                start: {
                    line: 181,
                    column: 4
                },
                end: {
                    line: 184,
                    column: 5
                }
            },
            '57': {
                start: {
                    line: 182,
                    column: 8
                },
                end: {
                    line: 182,
                    column: 17
                }
            },
            '58': {
                start: {
                    line: 183,
                    column: 8
                },
                end: {
                    line: 183,
                    column: 36
                }
            }
        },
        fnMap: {
            '0': {
                name: 'askPromise',
                decl: {
                    start: {
                        line: 34,
                        column: 9
                    },
                    end: {
                        line: 34,
                        column: 19
                    }
                },
                loc: {
                    start: {
                        line: 34,
                        column: 63
                    },
                    end: {
                        line: 60,
                        column: 1
                    }
                },
                line: 34
            },
            '1': {
                name: '(anonymous_1)',
                decl: {
                    start: {
                        line: 43,
                        column: 26
                    },
                    end: {
                        line: 43,
                        column: 27
                    }
                },
                loc: {
                    start: {
                        line: 43,
                        column: 47
                    },
                    end: {
                        line: 58,
                        column: 5
                    }
                },
                line: 43
            },
            '2': {
                name: 'askStream',
                decl: {
                    start: {
                        line: 62,
                        column: 9
                    },
                    end: {
                        line: 62,
                        column: 18
                    }
                },
                loc: {
                    start: {
                        line: 62,
                        column: 60
                    },
                    end: {
                        line: 92,
                        column: 1
                    }
                },
                line: 62
            },
            '3': {
                name: '(anonymous_3)',
                decl: {
                    start: {
                        line: 70,
                        column: 22
                    },
                    end: {
                        line: 70,
                        column: 23
                    }
                },
                loc: {
                    start: {
                        line: 70,
                        column: 42
                    },
                    end: {
                        line: 91,
                        column: 5
                    }
                },
                line: 70
            },
            '4': {
                name: '(anonymous_4)',
                decl: {
                    start: {
                        line: 71,
                        column: 28
                    },
                    end: {
                        line: 71,
                        column: 29
                    }
                },
                loc: {
                    start: {
                        line: 71,
                        column: 34
                    },
                    end: {
                        line: 71,
                        column: 36
                    }
                },
                line: 71
            },
            '5': {
                name: '(anonymous_5)',
                decl: {
                    start: {
                        line: 72,
                        column: 30
                    },
                    end: {
                        line: 72,
                        column: 31
                    }
                },
                loc: {
                    start: {
                        line: 72,
                        column: 62
                    },
                    end: {
                        line: 87,
                        column: 9
                    }
                },
                line: 72
            },
            '6': {
                name: '(anonymous_6)',
                decl: {
                    start: {
                        line: 88,
                        column: 15
                    },
                    end: {
                        line: 88,
                        column: 16
                    }
                },
                loc: {
                    start: {
                        line: 88,
                        column: 21
                    },
                    end: {
                        line: 90,
                        column: 9
                    }
                },
                line: 88
            },
            '7': {
                name: 'lookupSyncStatus',
                decl: {
                    start: {
                        line: 94,
                        column: 16
                    },
                    end: {
                        line: 94,
                        column: 32
                    }
                },
                loc: {
                    start: {
                        line: 94,
                        column: 52
                    },
                    end: {
                        line: 96,
                        column: 1
                    }
                },
                line: 94
            },
            '8': {
                name: 'lookupBlockHash',
                decl: {
                    start: {
                        line: 98,
                        column: 16
                    },
                    end: {
                        line: 98,
                        column: 31
                    }
                },
                loc: {
                    start: {
                        line: 98,
                        column: 65
                    },
                    end: {
                        line: 100,
                        column: 1
                    }
                },
                line: 98
            },
            '9': {
                name: 'chunkTransactions',
                decl: {
                    start: {
                        line: 102,
                        column: 16
                    },
                    end: {
                        line: 102,
                        column: 33
                    }
                },
                loc: {
                    start: {
                        line: 110,
                        column: 38
                    },
                    end: {
                        line: 126,
                        column: 1
                    }
                },
                line: 110
            },
            '10': {
                name: '(anonymous_10)',
                decl: {
                    start: {
                        line: 120,
                        column: 11
                    },
                    end: {
                        line: 120,
                        column: 12
                    }
                },
                loc: {
                    start: {
                        line: 120,
                        column: 77
                    },
                    end: {
                        line: 125,
                        column: 5
                    }
                },
                line: 120
            },
            '11': {
                name: 'returnSuccess',
                decl: {
                    start: {
                        line: 128,
                        column: 16
                    },
                    end: {
                        line: 128,
                        column: 29
                    }
                },
                loc: {
                    start: {
                        line: 128,
                        column: 57
                    },
                    end: {
                        line: 130,
                        column: 1
                    }
                },
                line: 128
            },
            '12': {
                name: 'returnError',
                decl: {
                    start: {
                        line: 132,
                        column: 16
                    },
                    end: {
                        line: 132,
                        column: 27
                    }
                },
                loc: {
                    start: {
                        line: 132,
                        column: 57
                    },
                    end: {
                        line: 135,
                        column: 1
                    }
                },
                line: 132
            },
            '13': {
                name: 'doPostMessage',
                decl: {
                    start: {
                        line: 137,
                        column: 9
                    },
                    end: {
                        line: 137,
                        column: 22
                    }
                },
                loc: {
                    start: {
                        line: 137,
                        column: 41
                    },
                    end: {
                        line: 141,
                        column: 1
                    }
                },
                line: 137
            },
            '14': {
                name: '(anonymous_14)',
                decl: {
                    start: {
                        line: 144,
                        column: 17
                    },
                    end: {
                        line: 144,
                        column: 18
                    }
                },
                loc: {
                    start: {
                        line: 144,
                        column: 53
                    },
                    end: {
                        line: 147,
                        column: 1
                    }
                },
                line: 144
            },
            '15': {
                name: '(anonymous_15)',
                decl: {
                    start: {
                        line: 161,
                        column: 22
                    },
                    end: {
                        line: 161,
                        column: 23
                    }
                },
                loc: {
                    start: {
                        line: 161,
                        column: 43
                    },
                    end: {
                        line: 175,
                        column: 1
                    }
                },
                line: 161
            },
            '16': {
                name: '(anonymous_16)',
                decl: {
                    start: {
                        line: 180,
                        column: 22
                    },
                    end: {
                        line: 180,
                        column: 23
                    }
                },
                loc: {
                    start: {
                        line: 180,
                        column: 43
                    },
                    end: {
                        line: 185,
                        column: 1
                    }
                },
                line: 180
            }
        },
        branchMap: {
            '0': {
                loc: {
                    start: {
                        line: 44,
                        column: 8
                    },
                    end: {
                        line: 51,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 44,
                        column: 8
                    },
                    end: {
                        line: 51,
                        column: 9
                    }
                }, {
                    start: {
                        line: 44,
                        column: 8
                    },
                    end: {
                        line: 51,
                        column: 9
                    }
                }],
                line: 44
            },
            '1': {
                loc: {
                    start: {
                        line: 45,
                        column: 12
                    },
                    end: {
                        line: 50,
                        column: 13
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 45,
                        column: 12
                    },
                    end: {
                        line: 50,
                        column: 13
                    }
                }, {
                    start: {
                        line: 45,
                        column: 12
                    },
                    end: {
                        line: 50,
                        column: 13
                    }
                }],
                line: 45
            },
            '2': {
                loc: {
                    start: {
                        line: 46,
                        column: 16
                    },
                    end: {
                        line: 49,
                        column: 17
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 46,
                        column: 16
                    },
                    end: {
                        line: 49,
                        column: 17
                    }
                }, {
                    start: {
                        line: 46,
                        column: 16
                    },
                    end: {
                        line: 49,
                        column: 17
                    }
                }],
                line: 46
            },
            '3': {
                loc: {
                    start: {
                        line: 52,
                        column: 8
                    },
                    end: {
                        line: 57,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 52,
                        column: 8
                    },
                    end: {
                        line: 57,
                        column: 9
                    }
                }, {
                    start: {
                        line: 52,
                        column: 8
                    },
                    end: {
                        line: 57,
                        column: 9
                    }
                }],
                line: 52
            },
            '4': {
                loc: {
                    start: {
                        line: 53,
                        column: 12
                    },
                    end: {
                        line: 56,
                        column: 13
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 53,
                        column: 12
                    },
                    end: {
                        line: 56,
                        column: 13
                    }
                }, {
                    start: {
                        line: 53,
                        column: 12
                    },
                    end: {
                        line: 56,
                        column: 13
                    }
                }],
                line: 53
            },
            '5': {
                loc: {
                    start: {
                        line: 74,
                        column: 12
                    },
                    end: {
                        line: 80,
                        column: 13
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 74,
                        column: 12
                    },
                    end: {
                        line: 80,
                        column: 13
                    }
                }, {
                    start: {
                        line: 74,
                        column: 12
                    },
                    end: {
                        line: 80,
                        column: 13
                    }
                }],
                line: 74
            },
            '6': {
                loc: {
                    start: {
                        line: 75,
                        column: 16
                    },
                    end: {
                        line: 79,
                        column: 17
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 75,
                        column: 16
                    },
                    end: {
                        line: 79,
                        column: 17
                    }
                }, {
                    start: {
                        line: 75,
                        column: 16
                    },
                    end: {
                        line: 79,
                        column: 17
                    }
                }],
                line: 75
            },
            '7': {
                loc: {
                    start: {
                        line: 76,
                        column: 20
                    },
                    end: {
                        line: 78,
                        column: 21
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 76,
                        column: 20
                    },
                    end: {
                        line: 78,
                        column: 21
                    }
                }, {
                    start: {
                        line: 76,
                        column: 20
                    },
                    end: {
                        line: 78,
                        column: 21
                    }
                }],
                line: 76
            },
            '8': {
                loc: {
                    start: {
                        line: 81,
                        column: 12
                    },
                    end: {
                        line: 86,
                        column: 13
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 81,
                        column: 12
                    },
                    end: {
                        line: 86,
                        column: 13
                    }
                }, {
                    start: {
                        line: 81,
                        column: 12
                    },
                    end: {
                        line: 86,
                        column: 13
                    }
                }],
                line: 81
            },
            '9': {
                loc: {
                    start: {
                        line: 82,
                        column: 16
                    },
                    end: {
                        line: 85,
                        column: 17
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 82,
                        column: 16
                    },
                    end: {
                        line: 85,
                        column: 17
                    }
                }, {
                    start: {
                        line: 82,
                        column: 16
                    },
                    end: {
                        line: 85,
                        column: 17
                    }
                }],
                line: 82
            },
            '10': {
                loc: {
                    start: {
                        line: 121,
                        column: 8
                    },
                    end: {
                        line: 123,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 121,
                        column: 8
                    },
                    end: {
                        line: 123,
                        column: 9
                    }
                }, {
                    start: {
                        line: 121,
                        column: 8
                    },
                    end: {
                        line: 123,
                        column: 9
                    }
                }],
                line: 121
            },
            '11': {
                loc: {
                    start: {
                        line: 133,
                        column: 33
                    },
                    end: {
                        line: 133,
                        column: 90
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 133,
                        column: 58
                    },
                    end: {
                        line: 133,
                        column: 71
                    }
                }, {
                    start: {
                        line: 133,
                        column: 74
                    },
                    end: {
                        line: 133,
                        column: 90
                    }
                }],
                line: 133
            },
            '12': {
                loc: {
                    start: {
                        line: 162,
                        column: 4
                    },
                    end: {
                        line: 174,
                        column: 5
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 162,
                        column: 4
                    },
                    end: {
                        line: 174,
                        column: 5
                    }
                }, {
                    start: {
                        line: 162,
                        column: 4
                    },
                    end: {
                        line: 174,
                        column: 5
                    }
                }],
                line: 162
            },
            '13': {
                loc: {
                    start: {
                        line: 181,
                        column: 4
                    },
                    end: {
                        line: 184,
                        column: 5
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 181,
                        column: 4
                    },
                    end: {
                        line: 184,
                        column: 5
                    }
                }, {
                    start: {
                        line: 181,
                        column: 4
                    },
                    end: {
                        line: 184,
                        column: 5
                    }
                }],
                line: 181
            }
        },
        s: {
            '0': 0,
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0,
            '5': 0,
            '6': 0,
            '7': 0,
            '8': 0,
            '9': 0,
            '10': 0,
            '11': 0,
            '12': 0,
            '13': 0,
            '14': 0,
            '15': 0,
            '16': 0,
            '17': 0,
            '18': 0,
            '19': 0,
            '20': 0,
            '21': 0,
            '22': 0,
            '23': 0,
            '24': 0,
            '25': 0,
            '26': 0,
            '27': 0,
            '28': 0,
            '29': 0,
            '30': 0,
            '31': 0,
            '32': 0,
            '33': 0,
            '34': 0,
            '35': 0,
            '36': 0,
            '37': 0,
            '38': 0,
            '39': 0,
            '40': 0,
            '41': 0,
            '42': 0,
            '43': 0,
            '44': 0,
            '45': 0,
            '46': 0,
            '47': 0,
            '48': 0,
            '49': 0,
            '50': 0,
            '51': 0,
            '52': 0,
            '53': 0,
            '54': 0,
            '55': 0,
            '56': 0,
            '57': 0,
            '58': 0
        },
        f: {
            '0': 0,
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0,
            '5': 0,
            '6': 0,
            '7': 0,
            '8': 0,
            '9': 0,
            '10': 0,
            '11': 0,
            '12': 0,
            '13': 0,
            '14': 0,
            '15': 0,
            '16': 0
        },
        b: {
            '0': [0, 0],
            '1': [0, 0],
            '2': [0, 0],
            '3': [0, 0],
            '4': [0, 0],
            '5': [0, 0],
            '6': [0, 0],
            '7': [0, 0],
            '8': [0, 0],
            '9': [0, 0],
            '10': [0, 0],
            '11': [0, 0],
            '12': [0, 0],
            '13': [0, 0]
        },
        _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
    },
        coverage = global[gcv] || (global[gcv] = {});

    if (coverage[path] && coverage[path].hash === hash) {
        return coverage[path];
    }

    coverageData.hash = hash;
    return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.startDiscoveryPromise = exports.initPromise = undefined;
exports.lookupSyncStatus = lookupSyncStatus;
exports.lookupBlockHash = lookupBlockHash;
exports.chunkTransactions = chunkTransactions;
exports.returnSuccess = returnSuccess;
exports.returnError = returnError;

var _deferred = require('../../../utils/deferred');

var _stream = require('../../../utils/stream');

// Code for all communication with outside

// There is a mechanism for "sending" Promise from outside here
// - first I send promiseRequest from worker to outside,
// and I either get promiseResponseSuccess or promiseResponseFailure
//
// Similar logic for Stream - I get streamRequest and
// streamResponseUpdate and streamResponseFinish
//
// It's maybe a little overkill :( but it allows me to have multiple streams
// and promises over one worker communication

var lastId = (cov_2hevsdeg8c.s[0]++, 0);

var messageEmitter = (cov_2hevsdeg8c.s[1]++, new _stream.Emitter());

function askPromise(request) {
    cov_2hevsdeg8c.f[0]++;

    var id = (cov_2hevsdeg8c.s[2]++, lastId + 1);
    cov_2hevsdeg8c.s[3]++;
    lastId++;
    cov_2hevsdeg8c.s[4]++;
    doPostMessage({
        type: 'promiseRequest',
        request: request,
        id: id
    });
    var dfd = (cov_2hevsdeg8c.s[5]++, (0, _deferred.deferred)());
    cov_2hevsdeg8c.s[6]++;
    messageEmitter.attach(function (message, detach) {
        cov_2hevsdeg8c.f[1]++;
        cov_2hevsdeg8c.s[7]++;

        if (message.type === 'promiseResponseSuccess') {
            cov_2hevsdeg8c.b[0][0]++;
            cov_2hevsdeg8c.s[8]++;

            if (message.response.type === request.type) {
                cov_2hevsdeg8c.b[1][0]++;
                cov_2hevsdeg8c.s[9]++;

                if (message.id === id) {
                    cov_2hevsdeg8c.b[2][0]++;
                    cov_2hevsdeg8c.s[10]++;

                    detach();
                    cov_2hevsdeg8c.s[11]++;
                    dfd.resolve(message.response.response);
                } else {
                    cov_2hevsdeg8c.b[2][1]++;
                }
            } else {
                cov_2hevsdeg8c.b[1][1]++;
            }
        } else {
            cov_2hevsdeg8c.b[0][1]++;
        }
        cov_2hevsdeg8c.s[12]++;
        if (message.type === 'promiseResponseFailure') {
            cov_2hevsdeg8c.b[3][0]++;
            cov_2hevsdeg8c.s[13]++;

            if (message.id === id) {
                cov_2hevsdeg8c.b[4][0]++;
                cov_2hevsdeg8c.s[14]++;

                detach();
                cov_2hevsdeg8c.s[15]++;
                dfd.reject(new Error(message.failure));
            } else {
                cov_2hevsdeg8c.b[4][1]++;
            }
        } else {
            cov_2hevsdeg8c.b[3][1]++;
        }
    });
    cov_2hevsdeg8c.s[16]++;
    return dfd.promise;
}

function askStream(request) {
    cov_2hevsdeg8c.f[2]++;

    var id = (cov_2hevsdeg8c.s[17]++, lastId + 1);
    cov_2hevsdeg8c.s[18]++;
    lastId++;
    cov_2hevsdeg8c.s[19]++;
    doPostMessage({
        type: 'streamRequest',
        request: request,
        id: id
    });
    cov_2hevsdeg8c.s[20]++;
    return new _stream.Stream(function (update, finish) {
        cov_2hevsdeg8c.f[3]++;
        cov_2hevsdeg8c.s[21]++;

        var emitterDetach = function emitterDetach() {
            cov_2hevsdeg8c.f[4]++;
        };
        cov_2hevsdeg8c.s[22]++;
        messageEmitter.attach(function (message, detach) {
            cov_2hevsdeg8c.f[5]++;
            cov_2hevsdeg8c.s[23]++;

            emitterDetach = detach;
            cov_2hevsdeg8c.s[24]++;
            if (message.type === 'streamResponseUpdate') {
                cov_2hevsdeg8c.b[5][0]++;
                cov_2hevsdeg8c.s[25]++;

                if (message.update.type === request.type) {
                    cov_2hevsdeg8c.b[6][0]++;
                    cov_2hevsdeg8c.s[26]++;

                    if (message.id === id) {
                        cov_2hevsdeg8c.b[7][0]++;
                        cov_2hevsdeg8c.s[27]++;

                        update(message.update.response);
                    } else {
                        cov_2hevsdeg8c.b[7][1]++;
                    }
                } else {
                    cov_2hevsdeg8c.b[6][1]++;
                }
            } else {
                cov_2hevsdeg8c.b[5][1]++;
            }
            cov_2hevsdeg8c.s[28]++;
            if (message.type === 'streamResponseFinish') {
                cov_2hevsdeg8c.b[8][0]++;
                cov_2hevsdeg8c.s[29]++;

                if (message.id === id) {
                    cov_2hevsdeg8c.b[9][0]++;
                    cov_2hevsdeg8c.s[30]++;

                    detach();
                    cov_2hevsdeg8c.s[31]++;
                    finish();
                } else {
                    cov_2hevsdeg8c.b[9][1]++;
                }
            } else {
                cov_2hevsdeg8c.b[8][1]++;
            }
        });
        cov_2hevsdeg8c.s[32]++;
        return function () {
            cov_2hevsdeg8c.f[6]++;
            cov_2hevsdeg8c.s[33]++;

            emitterDetach();
        };
    });
}

function lookupSyncStatus() {
    cov_2hevsdeg8c.f[7]++;
    cov_2hevsdeg8c.s[34]++;

    return askPromise({ type: 'lookupSyncStatus' });
}

function lookupBlockHash(height) {
    cov_2hevsdeg8c.f[8]++;
    cov_2hevsdeg8c.s[35]++;

    return askPromise({ type: 'lookupBlockHash', height: height });
}

function chunkTransactions(chainId, firstIndex, lastIndex, startBlock, endBlock, pseudoCount, addresses) {
    cov_2hevsdeg8c.f[9]++;
    cov_2hevsdeg8c.s[36]++;

    return askStream({
        type: 'chunkTransactions',
        chainId: chainId,
        firstIndex: firstIndex,
        lastIndex: lastIndex,
        startBlock: startBlock,
        endBlock: endBlock,
        pseudoCount: pseudoCount,
        addresses: addresses
    }).map(function (k) {
        cov_2hevsdeg8c.f[10]++;
        cov_2hevsdeg8c.s[37]++;

        if (typeof k === 'string') {
            cov_2hevsdeg8c.b[10][0]++;
            cov_2hevsdeg8c.s[38]++;

            return new Error(k);
        } else {
            cov_2hevsdeg8c.b[10][1]++;
        }
        cov_2hevsdeg8c.s[39]++;
        return k;
    });
}

function returnSuccess(result) {
    cov_2hevsdeg8c.f[11]++;
    cov_2hevsdeg8c.s[40]++;

    doPostMessage({ type: 'result', result: result });
}

function returnError(error) {
    cov_2hevsdeg8c.f[12]++;

    var errorMessage = (cov_2hevsdeg8c.s[41]++, error instanceof Error ? (cov_2hevsdeg8c.b[11][0]++, error.message) : (cov_2hevsdeg8c.b[11][1]++, error.toString()));
    cov_2hevsdeg8c.s[42]++;
    doPostMessage({ type: 'error', error: errorMessage });
}

function doPostMessage(data) {
    cov_2hevsdeg8c.f[13]++;
    cov_2hevsdeg8c.s[43]++;

    self.postMessage(data);
}

// eslint-disable-next-line no-undef
cov_2hevsdeg8c.s[44]++;
self.onmessage = function (event) {
    cov_2hevsdeg8c.f[14]++;

    var data = (cov_2hevsdeg8c.s[45]++, event.data);
    cov_2hevsdeg8c.s[46]++;
    messageEmitter.emit(data);
};

var initDfd = (cov_2hevsdeg8c.s[47]++, (0, _deferred.deferred)());
var initPromise = exports.initPromise = (cov_2hevsdeg8c.s[48]++, initDfd.promise);

cov_2hevsdeg8c.s[49]++;
messageEmitter.attach(function (message, detach) {
    cov_2hevsdeg8c.f[15]++;
    cov_2hevsdeg8c.s[50]++;

    if (message.type === 'init') {
        cov_2hevsdeg8c.b[12][0]++;
        cov_2hevsdeg8c.s[51]++;

        detach();
        cov_2hevsdeg8c.s[52]++;
        initDfd.resolve({
            accountInfo: message.state,
            network: message.network,
            xpub: message.xpub,
            segwit: message.segwit,
            webassembly: message.webassembly,
            cashAddress: message.cashAddress,
            gap: message.gap,
            timeOffset: message.timeOffset
        });
    } else {
        cov_2hevsdeg8c.b[12][1]++;
    }
});

var startDiscoveryDfd = (cov_2hevsdeg8c.s[53]++, (0, _deferred.deferred)());
var startDiscoveryPromise = exports.startDiscoveryPromise = (cov_2hevsdeg8c.s[54]++, startDiscoveryDfd.promise);

cov_2hevsdeg8c.s[55]++;
messageEmitter.attach(function (message, detach) {
    cov_2hevsdeg8c.f[16]++;
    cov_2hevsdeg8c.s[56]++;

    if (message.type === 'startDiscovery') {
        cov_2hevsdeg8c.b[13][0]++;
        cov_2hevsdeg8c.s[57]++;

        detach();
        cov_2hevsdeg8c.s[58]++;
        startDiscoveryDfd.resolve();
    } else {
        cov_2hevsdeg8c.b[13][1]++;
    }
});