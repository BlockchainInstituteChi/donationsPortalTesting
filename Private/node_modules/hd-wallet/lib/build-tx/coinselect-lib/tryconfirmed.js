'use strict';

var cov_ixzfg21l8 = function () {
    var path = '/home/g/dev/hd-wallet/src/build-tx/coinselect-lib/tryconfirmed.js',
        hash = '84471fd066d157491c250dd960948238a3182942',
        Function = function () {}.constructor,
        global = new Function('return this')(),
        gcv = '__coverage__',
        coverageData = {
        path: '/home/g/dev/hd-wallet/src/build-tx/coinselect-lib/tryconfirmed.js',
        statementMap: {
            '0': {
                start: {
                    line: 2,
                    column: 4
                },
                end: {
                    line: 7,
                    column: 7
                }
            },
            '1': {
                start: {
                    line: 3,
                    column: 8
                },
                end: {
                    line: 5,
                    column: 9
                }
            },
            '2': {
                start: {
                    line: 4,
                    column: 12
                },
                end: {
                    line: 4,
                    column: 57
                }
            },
            '3': {
                start: {
                    line: 6,
                    column: 8
                },
                end: {
                    line: 6,
                    column: 20
                }
            },
            '4': {
                start: {
                    line: 11,
                    column: 19
                },
                end: {
                    line: 11,
                    column: 21
                }
            },
            '5': {
                start: {
                    line: 12,
                    column: 21
                },
                end: {
                    line: 12,
                    column: 23
                }
            },
            '6': {
                start: {
                    line: 14,
                    column: 4
                },
                end: {
                    line: 26,
                    column: 5
                }
            },
            '7': {
                start: {
                    line: 15,
                    column: 21
                },
                end: {
                    line: 15,
                    column: 29
                }
            },
            '8': {
                start: {
                    line: 17,
                    column: 23
                },
                end: {
                    line: 19,
                    column: 48
                }
            },
            '9': {
                start: {
                    line: 21,
                    column: 8
                },
                end: {
                    line: 25,
                    column: 9
                }
            },
            '10': {
                start: {
                    line: 22,
                    column: 12
                },
                end: {
                    line: 22,
                    column: 30
                }
            },
            '11': {
                start: {
                    line: 24,
                    column: 12
                },
                end: {
                    line: 24,
                    column: 32
                }
            },
            '12': {
                start: {
                    line: 27,
                    column: 4
                },
                end: {
                    line: 30,
                    column: 6
                }
            },
            '13': {
                start: {
                    line: 33,
                    column: 0
                },
                end: {
                    line: 97,
                    column: 2
                }
            },
            '14': {
                start: {
                    line: 34,
                    column: 16
                },
                end: {
                    line: 34,
                    column: 32
                }
            },
            '15': {
                start: {
                    line: 35,
                    column: 18
                },
                end: {
                    line: 35,
                    column: 36
                }
            },
            '16': {
                start: {
                    line: 36,
                    column: 21
                },
                end: {
                    line: 36,
                    column: 44
                }
            },
            '17': {
                start: {
                    line: 38,
                    column: 4
                },
                end: {
                    line: 96,
                    column: 6
                }
            },
            '18': {
                start: {
                    line: 39,
                    column: 8
                },
                end: {
                    line: 43,
                    column: 11
                }
            },
            '19': {
                start: {
                    line: 40,
                    column: 12
                },
                end: {
                    line: 42,
                    column: 13
                }
            },
            '20': {
                start: {
                    line: 41,
                    column: 16
                },
                end: {
                    line: 41,
                    column: 56
                }
            },
            '21': {
                start: {
                    line: 45,
                    column: 8
                },
                end: {
                    line: 45,
                    column: 48
                }
            },
            '22': {
                start: {
                    line: 47,
                    column: 8
                },
                end: {
                    line: 49,
                    column: 9
                }
            },
            '23': {
                start: {
                    line: 48,
                    column: 12
                },
                end: {
                    line: 48,
                    column: 22
                }
            },
            '24': {
                start: {
                    line: 51,
                    column: 23
                },
                end: {
                    line: 51,
                    column: 25
                }
            },
            '25': {
                start: {
                    line: 55,
                    column: 8
                },
                end: {
                    line: 57,
                    column: 9
                }
            },
            '26': {
                start: {
                    line: 56,
                    column: 12
                },
                end: {
                    line: 56,
                    column: 48
                }
            },
            '27': {
                start: {
                    line: 60,
                    column: 8
                },
                end: {
                    line: 62,
                    column: 9
                }
            },
            '28': {
                start: {
                    line: 61,
                    column: 12
                },
                end: {
                    line: 61,
                    column: 44
                }
            },
            '29': {
                start: {
                    line: 65,
                    column: 8
                },
                end: {
                    line: 65,
                    column: 40
                }
            },
            '30': {
                start: {
                    line: 66,
                    column: 8
                },
                end: {
                    line: 66,
                    column: 40
                }
            },
            '31': {
                start: {
                    line: 68,
                    column: 23
                },
                end: {
                    line: 68,
                    column: 28
                }
            },
            '32': {
                start: {
                    line: 69,
                    column: 21
                },
                end: {
                    line: 69,
                    column: 23
                }
            },
            '33': {
                start: {
                    line: 71,
                    column: 8
                },
                end: {
                    line: 92,
                    column: 9
                }
            },
            '34': {
                start: {
                    line: 72,
                    column: 26
                },
                end: {
                    line: 72,
                    column: 35
                }
            },
            '35': {
                start: {
                    line: 75,
                    column: 33
                },
                end: {
                    line: 75,
                    column: 88
                }
            },
            '36': {
                start: {
                    line: 78,
                    column: 12
                },
                end: {
                    line: 91,
                    column: 13
                }
            },
            '37': {
                start: {
                    line: 79,
                    column: 16
                },
                end: {
                    line: 79,
                    column: 60
                }
            },
            '38': {
                start: {
                    line: 80,
                    column: 16
                },
                end: {
                    line: 80,
                    column: 49
                }
            },
            '39': {
                start: {
                    line: 82,
                    column: 31
                },
                end: {
                    line: 82,
                    column: 77
                }
            },
            '40': {
                start: {
                    line: 83,
                    column: 16
                },
                end: {
                    line: 85,
                    column: 17
                }
            },
            '41': {
                start: {
                    line: 84,
                    column: 20
                },
                end: {
                    line: 84,
                    column: 34
                }
            },
            '42': {
                start: {
                    line: 88,
                    column: 16
                },
                end: {
                    line: 90,
                    column: 17
                }
            },
            '43': {
                start: {
                    line: 89,
                    column: 20
                },
                end: {
                    line: 89,
                    column: 34
                }
            }
        },
        fnMap: {
            '0': {
                name: 'filterCoinbase',
                decl: {
                    start: {
                        line: 1,
                        column: 9
                    },
                    end: {
                        line: 1,
                        column: 23
                    }
                },
                loc: {
                    start: {
                        line: 1,
                        column: 48
                    },
                    end: {
                        line: 8,
                        column: 1
                    }
                },
                line: 1
            },
            '1': {
                name: '(anonymous_1)',
                decl: {
                    start: {
                        line: 2,
                        column: 24
                    },
                    end: {
                        line: 2,
                        column: 25
                    }
                },
                loc: {
                    start: {
                        line: 2,
                        column: 40
                    },
                    end: {
                        line: 7,
                        column: 5
                    }
                },
                line: 2
            },
            '2': {
                name: 'filterUtxos',
                decl: {
                    start: {
                        line: 10,
                        column: 9
                    },
                    end: {
                        line: 10,
                        column: 20
                    }
                },
                loc: {
                    start: {
                        line: 10,
                        column: 54
                    },
                    end: {
                        line: 31,
                        column: 1
                    }
                },
                line: 10
            },
            '3': {
                name: 'tryConfirmed',
                decl: {
                    start: {
                        line: 33,
                        column: 26
                    },
                    end: {
                        line: 33,
                        column: 38
                    }
                },
                loc: {
                    start: {
                        line: 33,
                        column: 59
                    },
                    end: {
                        line: 97,
                        column: 1
                    }
                },
                line: 33
            },
            '4': {
                name: '(anonymous_4)',
                decl: {
                    start: {
                        line: 38,
                        column: 11
                    },
                    end: {
                        line: 38,
                        column: 12
                    }
                },
                loc: {
                    start: {
                        line: 38,
                        column: 57
                    },
                    end: {
                        line: 96,
                        column: 5
                    }
                },
                line: 38
            },
            '5': {
                name: '(anonymous_5)',
                decl: {
                    start: {
                        line: 39,
                        column: 22
                    },
                    end: {
                        line: 39,
                        column: 23
                    }
                },
                loc: {
                    start: {
                        line: 39,
                        column: 38
                    },
                    end: {
                        line: 43,
                        column: 9
                    }
                },
                line: 39
            }
        },
        branchMap: {
            '0': {
                loc: {
                    start: {
                        line: 3,
                        column: 8
                    },
                    end: {
                        line: 5,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 3,
                        column: 8
                    },
                    end: {
                        line: 5,
                        column: 9
                    }
                }, {
                    start: {
                        line: 3,
                        column: 8
                    },
                    end: {
                        line: 5,
                        column: 9
                    }
                }],
                line: 3
            },
            '1': {
                loc: {
                    start: {
                        line: 17,
                        column: 23
                    },
                    end: {
                        line: 19,
                        column: 48
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 18,
                        column: 14
                    },
                    end: {
                        line: 18,
                        column: 46
                    }
                }, {
                    start: {
                        line: 19,
                        column: 14
                    },
                    end: {
                        line: 19,
                        column: 48
                    }
                }],
                line: 17
            },
            '2': {
                loc: {
                    start: {
                        line: 21,
                        column: 8
                    },
                    end: {
                        line: 25,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 21,
                        column: 8
                    },
                    end: {
                        line: 25,
                        column: 9
                    }
                }, {
                    start: {
                        line: 21,
                        column: 8
                    },
                    end: {
                        line: 25,
                        column: 9
                    }
                }],
                line: 21
            },
            '3': {
                loc: {
                    start: {
                        line: 34,
                        column: 16
                    },
                    end: {
                        line: 34,
                        column: 32
                    }
                },
                type: 'binary-expr',
                locations: [{
                    start: {
                        line: 34,
                        column: 16
                    },
                    end: {
                        line: 34,
                        column: 27
                    }
                }, {
                    start: {
                        line: 34,
                        column: 31
                    },
                    end: {
                        line: 34,
                        column: 32
                    }
                }],
                line: 34
            },
            '4': {
                loc: {
                    start: {
                        line: 35,
                        column: 18
                    },
                    end: {
                        line: 35,
                        column: 36
                    }
                },
                type: 'binary-expr',
                locations: [{
                    start: {
                        line: 35,
                        column: 18
                    },
                    end: {
                        line: 35,
                        column: 31
                    }
                }, {
                    start: {
                        line: 35,
                        column: 35
                    },
                    end: {
                        line: 35,
                        column: 36
                    }
                }],
                line: 35
            },
            '5': {
                loc: {
                    start: {
                        line: 36,
                        column: 21
                    },
                    end: {
                        line: 36,
                        column: 44
                    }
                },
                type: 'binary-expr',
                locations: [{
                    start: {
                        line: 36,
                        column: 21
                    },
                    end: {
                        line: 36,
                        column: 37
                    }
                }, {
                    start: {
                        line: 36,
                        column: 41
                    },
                    end: {
                        line: 36,
                        column: 44
                    }
                }],
                line: 36
            },
            '6': {
                loc: {
                    start: {
                        line: 40,
                        column: 12
                    },
                    end: {
                        line: 42,
                        column: 13
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 40,
                        column: 12
                    },
                    end: {
                        line: 42,
                        column: 13
                    }
                }, {
                    start: {
                        line: 40,
                        column: 12
                    },
                    end: {
                        line: 42,
                        column: 13
                    }
                }],
                line: 40
            },
            '7': {
                loc: {
                    start: {
                        line: 40,
                        column: 16
                    },
                    end: {
                        line: 40,
                        column: 87
                    }
                },
                type: 'binary-expr',
                locations: [{
                    start: {
                        line: 40,
                        column: 16
                    },
                    end: {
                        line: 40,
                        column: 37
                    }
                }, {
                    start: {
                        line: 40,
                        column: 41
                    },
                    end: {
                        line: 40,
                        column: 57
                    }
                }, {
                    start: {
                        line: 40,
                        column: 61
                    },
                    end: {
                        line: 40,
                        column: 87
                    }
                }],
                line: 40
            },
            '8': {
                loc: {
                    start: {
                        line: 47,
                        column: 8
                    },
                    end: {
                        line: 49,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 47,
                        column: 8
                    },
                    end: {
                        line: 49,
                        column: 9
                    }
                }, {
                    start: {
                        line: 47,
                        column: 8
                    },
                    end: {
                        line: 49,
                        column: 9
                    }
                }],
                line: 47
            },
            '9': {
                loc: {
                    start: {
                        line: 78,
                        column: 12
                    },
                    end: {
                        line: 91,
                        column: 13
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 78,
                        column: 12
                    },
                    end: {
                        line: 91,
                        column: 13
                    }
                }, {
                    start: {
                        line: 78,
                        column: 12
                    },
                    end: {
                        line: 91,
                        column: 13
                    }
                }],
                line: 78
            },
            '10': {
                loc: {
                    start: {
                        line: 83,
                        column: 16
                    },
                    end: {
                        line: 85,
                        column: 17
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 83,
                        column: 16
                    },
                    end: {
                        line: 85,
                        column: 17
                    }
                }, {
                    start: {
                        line: 83,
                        column: 16
                    },
                    end: {
                        line: 85,
                        column: 17
                    }
                }],
                line: 83
            },
            '11': {
                loc: {
                    start: {
                        line: 88,
                        column: 16
                    },
                    end: {
                        line: 90,
                        column: 17
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 88,
                        column: 16
                    },
                    end: {
                        line: 90,
                        column: 17
                    }
                }, {
                    start: {
                        line: 88,
                        column: 16
                    },
                    end: {
                        line: 90,
                        column: 17
                    }
                }],
                line: 88
            }
        },
        s: {
            '0': 0,
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0,
            '5': 0,
            '6': 0,
            '7': 0,
            '8': 0,
            '9': 0,
            '10': 0,
            '11': 0,
            '12': 0,
            '13': 0,
            '14': 0,
            '15': 0,
            '16': 0,
            '17': 0,
            '18': 0,
            '19': 0,
            '20': 0,
            '21': 0,
            '22': 0,
            '23': 0,
            '24': 0,
            '25': 0,
            '26': 0,
            '27': 0,
            '28': 0,
            '29': 0,
            '30': 0,
            '31': 0,
            '32': 0,
            '33': 0,
            '34': 0,
            '35': 0,
            '36': 0,
            '37': 0,
            '38': 0,
            '39': 0,
            '40': 0,
            '41': 0,
            '42': 0,
            '43': 0
        },
        f: {
            '0': 0,
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0,
            '5': 0
        },
        b: {
            '0': [0, 0],
            '1': [0, 0],
            '2': [0, 0],
            '3': [0, 0],
            '4': [0, 0],
            '5': [0, 0],
            '6': [0, 0],
            '7': [0, 0, 0],
            '8': [0, 0],
            '9': [0, 0],
            '10': [0, 0],
            '11': [0, 0]
        },
        _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
    },
        coverage = global[gcv] || (global[gcv] = {});

    if (coverage[path] && coverage[path].hash === hash) {
        return coverage[path];
    }

    coverageData.hash = hash;
    return coverage[path] = coverageData;
}();

function filterCoinbase(utxos, minConfCoinbase) {
    cov_ixzfg21l8.f[0]++;
    cov_ixzfg21l8.s[0]++;

    return utxos.filter(function (utxo) {
        cov_ixzfg21l8.f[1]++;
        cov_ixzfg21l8.s[1]++;

        if (utxo.coinbase) {
            cov_ixzfg21l8.b[0][0]++;
            cov_ixzfg21l8.s[2]++;

            return utxo.confirmations >= minConfCoinbase;
        } else {
            cov_ixzfg21l8.b[0][1]++;
        }
        cov_ixzfg21l8.s[3]++;
        return true;
    });
}

function filterUtxos(utxos, minConfOwn, minConfOther) {
    cov_ixzfg21l8.f[2]++;

    var usable = (cov_ixzfg21l8.s[4]++, []);
    var unusable = (cov_ixzfg21l8.s[5]++, []);

    cov_ixzfg21l8.s[6]++;
    for (var i = 0; i < utxos.length; i++) {
        var utxo = (cov_ixzfg21l8.s[7]++, utxos[i]);

        var isUsed = (cov_ixzfg21l8.s[8]++, utxo.own ? (cov_ixzfg21l8.b[1][0]++, utxo.confirmations >= minConfOwn) : (cov_ixzfg21l8.b[1][1]++, utxo.confirmations >= minConfOther));

        cov_ixzfg21l8.s[9]++;
        if (isUsed) {
            cov_ixzfg21l8.b[2][0]++;
            cov_ixzfg21l8.s[10]++;

            usable.push(utxo);
        } else {
            cov_ixzfg21l8.b[2][1]++;
            cov_ixzfg21l8.s[11]++;

            unusable.push(utxo);
        }
    }
    cov_ixzfg21l8.s[12]++;
    return {
        usable: usable,
        unusable: unusable
    };
}

cov_ixzfg21l8.s[13]++;
module.exports = function tryConfirmed(algorithm, options) {
    cov_ixzfg21l8.f[3]++;

    var own = (cov_ixzfg21l8.s[14]++, (cov_ixzfg21l8.b[3][0]++, options.own) || (cov_ixzfg21l8.b[3][1]++, 1));
    var other = (cov_ixzfg21l8.s[15]++, (cov_ixzfg21l8.b[4][0]++, options.other) || (cov_ixzfg21l8.b[4][1]++, 6));
    var coinbase = (cov_ixzfg21l8.s[16]++, (cov_ixzfg21l8.b[5][0]++, options.coinbase) || (cov_ixzfg21l8.b[5][1]++, 100));

    cov_ixzfg21l8.s[17]++;
    return function (utxos, outputs, feeRate, optionsIn) {
        cov_ixzfg21l8.f[4]++;
        cov_ixzfg21l8.s[18]++;

        utxos.forEach(function (utxo) {
            cov_ixzfg21l8.f[5]++;
            cov_ixzfg21l8.s[19]++;

            if ((cov_ixzfg21l8.b[7][0]++, utxo.coinbase == null) || (cov_ixzfg21l8.b[7][1]++, utxo.own == null) || (cov_ixzfg21l8.b[7][2]++, utxo.confirmations == null)) {
                cov_ixzfg21l8.b[6][0]++;
                cov_ixzfg21l8.s[20]++;

                throw new Error('Missing information.');
            } else {
                cov_ixzfg21l8.b[6][1]++;
            }
        });

        cov_ixzfg21l8.s[21]++;
        utxos = filterCoinbase(utxos, coinbase);

        cov_ixzfg21l8.s[22]++;
        if (utxos.length === 0) {
            cov_ixzfg21l8.b[8][0]++;
            cov_ixzfg21l8.s[23]++;

            return {};
        } else {
            cov_ixzfg21l8.b[8][1]++;
        }

        var trials = (cov_ixzfg21l8.s[24]++, []);

        var i = void 0;
        // first - let's keep others at options.other and let's try decrease own, but not to 0
        cov_ixzfg21l8.s[25]++;
        for (i = own; i > 0; i--) {
            cov_ixzfg21l8.s[26]++;

            trials.push({ other: other, own: i });
        }

        // if that did not work, let's try to decrease other, keeping own at 1
        cov_ixzfg21l8.s[27]++;
        for (i = other - 1; i > 0; i--) {
            cov_ixzfg21l8.s[28]++;

            trials.push({ other: i, own: 1 });
        }

        // if that did not work, first allow own unconfirmed, then all unconfirmed
        cov_ixzfg21l8.s[29]++;
        trials.push({ other: 1, own: 0 });
        cov_ixzfg21l8.s[30]++;
        trials.push({ other: 0, own: 0 });

        var unusable = (cov_ixzfg21l8.s[31]++, utxos);
        var usable = (cov_ixzfg21l8.s[32]++, []);

        cov_ixzfg21l8.s[33]++;
        for (i = 0; i < trials.length; i++) {
            var trial = (cov_ixzfg21l8.s[34]++, trials[i]);

            // since the restrictions are always loosening, we can just filter the unusable so far
            var filterResult = (cov_ixzfg21l8.s[35]++, filterUtxos(unusable, trial.own, trial.other, coinbase));

            // and we can try the algorithm only if there are some newly usable utxos
            cov_ixzfg21l8.s[36]++;
            if (filterResult.usable.length > 0) {
                cov_ixzfg21l8.b[9][0]++;
                cov_ixzfg21l8.s[37]++;

                usable = usable.concat(filterResult.usable);
                cov_ixzfg21l8.s[38]++;
                unusable = filterResult.unusable;

                var result = (cov_ixzfg21l8.s[39]++, algorithm(usable, outputs, feeRate, optionsIn));
                cov_ixzfg21l8.s[40]++;
                if (result.inputs) {
                    cov_ixzfg21l8.b[10][0]++;
                    cov_ixzfg21l8.s[41]++;

                    return result;
                } else {
                    cov_ixzfg21l8.b[10][1]++;
                }

                // we tried all inputs already
                cov_ixzfg21l8.s[42]++;
                if (unusable.length === 0) {
                    cov_ixzfg21l8.b[11][0]++;
                    cov_ixzfg21l8.s[43]++;

                    return result;
                } else {
                    cov_ixzfg21l8.b[11][1]++;
                }
            } else {
                cov_ixzfg21l8.b[9][1]++;
            }
        }

        // we should never end here
        // throw new Error('Unexpected unreturned result')
    };
};