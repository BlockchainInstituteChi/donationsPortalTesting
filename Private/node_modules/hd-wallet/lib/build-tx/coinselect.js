'use strict';

var cov_2khk1ppals = function () {
    var path = '/home/g/dev/hd-wallet/src/build-tx/coinselect.js',
        hash = '16ae76079fe893e61251bd4a92eff454994d08ec',
        Function = function () {}.constructor,
        global = new Function('return this')(),
        gcv = '__coverage__',
        coverageData = {
        path: '/home/g/dev/hd-wallet/src/build-tx/coinselect.js',
        statementMap: {
            '0': {
                start: {
                    line: 22,
                    column: 35
                },
                end: {
                    line: 22,
                    column: 37
                }
            },
            '1': {
                start: {
                    line: 23,
                    column: 28
                },
                end: {
                    line: 23,
                    column: 31
                }
            },
            '2': {
                start: {
                    line: 24,
                    column: 35
                },
                end: {
                    line: 24,
                    column: 37
                }
            },
            '3': {
                start: {
                    line: 25,
                    column: 34
                },
                end: {
                    line: 25,
                    column: 36
                }
            },
            '4': {
                start: {
                    line: 26,
                    column: 36
                },
                end: {
                    line: 26,
                    column: 38
                }
            },
            '5': {
                start: {
                    line: 27,
                    column: 35
                },
                end: {
                    line: 27,
                    column: 37
                }
            },
            '6': {
                start: {
                    line: 83,
                    column: 19
                },
                end: {
                    line: 83,
                    column: 55
                }
            },
            '7': {
                start: {
                    line: 84,
                    column: 20
                },
                end: {
                    line: 84,
                    column: 53
                }
            },
            '8': {
                start: {
                    line: 85,
                    column: 20
                },
                end: {
                    line: 89,
                    column: 5
                }
            },
            '9': {
                start: {
                    line: 91,
                    column: 22
                },
                end: {
                    line: 91,
                    column: 69
                }
            },
            '10': {
                start: {
                    line: 92,
                    column: 19
                },
                end: {
                    line: 92,
                    column: 63
                }
            },
            '11': {
                start: {
                    line: 93,
                    column: 4
                },
                end: {
                    line: 118,
                    column: 5
                }
            },
            '12': {
                start: {
                    line: 94,
                    column: 8
                },
                end: {
                    line: 96,
                    column: 10
                }
            },
            '13': {
                start: {
                    line: 98,
                    column: 20
                },
                end: {
                    line: 98,
                    column: 30
                }
            },
            '14': {
                start: {
                    line: 99,
                    column: 20
                },
                end: {
                    line: 99,
                    column: 77
                }
            },
            '15': {
                start: {
                    line: 101,
                    column: 27
                },
                end: {
                    line: 104,
                    column: 68
                }
            },
            '16': {
                start: {
                    line: 103,
                    column: 12
                },
                end: {
                    line: 103,
                    column: 41
                }
            },
            '17': {
                start: {
                    line: 104,
                    column: 20
                },
                end: {
                    line: 104,
                    column: 27
                }
            },
            '18': {
                start: {
                    line: 104,
                    column: 46
                },
                end: {
                    line: 104,
                    column: 51
                }
            },
            '19': {
                start: {
                    line: 106,
                    column: 24
                },
                end: {
                    line: 106,
                    column: 71
                }
            },
            '20': {
                start: {
                    line: 107,
                    column: 27
                },
                end: {
                    line: 107,
                    column: 40
                }
            },
            '21': {
                start: {
                    line: 108,
                    column: 8
                },
                end: {
                    line: 117,
                    column: 10
                }
            },
            '22': {
                start: {
                    line: 126,
                    column: 26
                },
                end: {
                    line: 126,
                    column: 83
                }
            },
            '23': {
                start: {
                    line: 127,
                    column: 4
                },
                end: {
                    line: 136,
                    column: 8
                }
            },
            '24': {
                start: {
                    line: 127,
                    column: 37
                },
                end: {
                    line: 136,
                    column: 5
                }
            },
            '25': {
                start: {
                    line: 140,
                    column: 4
                },
                end: {
                    line: 145,
                    column: 5
                }
            },
            '26': {
                start: {
                    line: 141,
                    column: 8
                },
                end: {
                    line: 141,
                    column: 45
                }
            },
            '27': {
                start: {
                    line: 142,
                    column: 8
                },
                end: {
                    line: 142,
                    column: 20
                }
            },
            '28': {
                start: {
                    line: 144,
                    column: 8
                },
                end: {
                    line: 144,
                    column: 21
                }
            },
            '29': {
                start: {
                    line: 149,
                    column: 17
                },
                end: {
                    line: 149,
                    column: 34
                }
            },
            '30': {
                start: {
                    line: 151,
                    column: 4
                },
                end: {
                    line: 157,
                    column: 5
                }
            },
            '31': {
                start: {
                    line: 152,
                    column: 24
                },
                end: {
                    line: 152,
                    column: 85
                }
            },
            '32': {
                start: {
                    line: 153,
                    column: 8
                },
                end: {
                    line: 153,
                    column: 60
                }
            },
            '33': {
                start: {
                    line: 155,
                    column: 24
                },
                end: {
                    line: 155,
                    column: 60
                }
            },
            '34': {
                start: {
                    line: 156,
                    column: 8
                },
                end: {
                    line: 156,
                    column: 48
                }
            },
            '35': {
                start: {
                    line: 159,
                    column: 19
                },
                end: {
                    line: 161,
                    column: 79
                }
            },
            '36': {
                start: {
                    line: 162,
                    column: 4
                },
                end: {
                    line: 162,
                    column: 20
                }
            },
            '37': {
                start: {
                    line: 170,
                    column: 26
                },
                end: {
                    line: 170,
                    column: 62
                }
            },
            '38': {
                start: {
                    line: 171,
                    column: 4
                },
                end: {
                    line: 201,
                    column: 7
                }
            },
            '39': {
                start: {
                    line: 172,
                    column: 8
                },
                end: {
                    line: 177,
                    column: 9
                }
            },
            '40': {
                start: {
                    line: 173,
                    column: 12
                },
                end: {
                    line: 176,
                    column: 14
                }
            },
            '41': {
                start: {
                    line: 178,
                    column: 8
                },
                end: {
                    line: 183,
                    column: 9
                }
            },
            '42': {
                start: {
                    line: 179,
                    column: 12
                },
                end: {
                    line: 182,
                    column: 14
                }
            },
            '43': {
                start: {
                    line: 184,
                    column: 8
                },
                end: {
                    line: 189,
                    column: 9
                }
            },
            '44': {
                start: {
                    line: 185,
                    column: 12
                },
                end: {
                    line: 188,
                    column: 14
                }
            },
            '45': {
                start: {
                    line: 190,
                    column: 8
                },
                end: {
                    line: 194,
                    column: 9
                }
            },
            '46': {
                start: {
                    line: 191,
                    column: 12
                },
                end: {
                    line: 193,
                    column: 14
                }
            },
            '47': {
                start: {
                    line: 195,
                    column: 8
                },
                end: {
                    line: 199,
                    column: 9
                }
            },
            '48': {
                start: {
                    line: 196,
                    column: 12
                },
                end: {
                    line: 198,
                    column: 14
                }
            },
            '49': {
                start: {
                    line: 200,
                    column: 8
                },
                end: {
                    line: 200,
                    column: 45
                }
            }
        },
        fnMap: {
            '0': {
                name: 'coinselect',
                decl: {
                    start: {
                        line: 72,
                        column: 16
                    },
                    end: {
                        line: 72,
                        column: 26
                    }
                },
                loc: {
                    start: {
                        line: 82,
                        column: 10
                    },
                    end: {
                        line: 119,
                        column: 1
                    }
                },
                line: 82
            },
            '1': {
                name: '(anonymous_1)',
                decl: {
                    start: {
                        line: 101,
                        column: 49
                    },
                    end: {
                        line: 101,
                        column: 50
                    }
                },
                loc: {
                    start: {
                        line: 101,
                        column: 64
                    },
                    end: {
                        line: 104,
                        column: 9
                    }
                },
                line: 101
            },
            '2': {
                name: '(anonymous_2)',
                decl: {
                    start: {
                        line: 104,
                        column: 15
                    },
                    end: {
                        line: 104,
                        column: 16
                    }
                },
                loc: {
                    start: {
                        line: 104,
                        column: 20
                    },
                    end: {
                        line: 104,
                        column: 27
                    }
                },
                line: 104
            },
            '3': {
                name: '(anonymous_3)',
                decl: {
                    start: {
                        line: 104,
                        column: 36
                    },
                    end: {
                        line: 104,
                        column: 37
                    }
                },
                loc: {
                    start: {
                        line: 104,
                        column: 46
                    },
                    end: {
                        line: 104,
                        column: 51
                    }
                },
                line: 104
            },
            '4': {
                name: 'convertInputs',
                decl: {
                    start: {
                        line: 121,
                        column: 9
                    },
                    end: {
                        line: 121,
                        column: 22
                    }
                },
                loc: {
                    start: {
                        line: 125,
                        column: 16
                    },
                    end: {
                        line: 137,
                        column: 1
                    }
                },
                line: 125
            },
            '5': {
                name: '(anonymous_5)',
                decl: {
                    start: {
                        line: 127,
                        column: 22
                    },
                    end: {
                        line: 127,
                        column: 23
                    }
                },
                loc: {
                    start: {
                        line: 127,
                        column: 37
                    },
                    end: {
                        line: 136,
                        column: 5
                    }
                },
                line: 127
            },
            '6': {
                name: 'isBech32',
                decl: {
                    start: {
                        line: 139,
                        column: 9
                    },
                    end: {
                        line: 139,
                        column: 17
                    }
                },
                loc: {
                    start: {
                        line: 139,
                        column: 44
                    },
                    end: {
                        line: 146,
                        column: 1
                    }
                },
                line: 139
            },
            '7': {
                name: 'getScriptAddress',
                decl: {
                    start: {
                        line: 148,
                        column: 9
                    },
                    end: {
                        line: 148,
                        column: 25
                    }
                },
                loc: {
                    start: {
                        line: 148,
                        column: 88
                    },
                    end: {
                        line: 163,
                        column: 1
                    }
                },
                line: 148
            },
            '8': {
                name: 'convertOutputs',
                decl: {
                    start: {
                        line: 165,
                        column: 9
                    },
                    end: {
                        line: 165,
                        column: 23
                    }
                },
                loc: {
                    start: {
                        line: 168,
                        column: 19
                    },
                    end: {
                        line: 202,
                        column: 1
                    }
                },
                line: 168
            },
            '9': {
                name: '(anonymous_9)',
                decl: {
                    start: {
                        line: 171,
                        column: 23
                    },
                    end: {
                        line: 171,
                        column: 24
                    }
                },
                loc: {
                    start: {
                        line: 171,
                        column: 33
                    },
                    end: {
                        line: 201,
                        column: 5
                    }
                },
                line: 171
            }
        },
        branchMap: {
            '0': {
                loc: {
                    start: {
                        line: 86,
                        column: 21
                    },
                    end: {
                        line: 86,
                        column: 78
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 86,
                        column: 30
                    },
                    end: {
                        line: 86,
                        column: 56
                    }
                }, {
                    start: {
                        line: 86,
                        column: 59
                    },
                    end: {
                        line: 86,
                        column: 78
                    }
                }],
                line: 86
            },
            '1': {
                loc: {
                    start: {
                        line: 87,
                        column: 28
                    },
                    end: {
                        line: 87,
                        column: 91
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 87,
                        column: 37
                    },
                    end: {
                        line: 87,
                        column: 62
                    }
                }, {
                    start: {
                        line: 87,
                        column: 65
                    },
                    end: {
                        line: 87,
                        column: 91
                    }
                }],
                line: 87
            },
            '2': {
                loc: {
                    start: {
                        line: 91,
                        column: 22
                    },
                    end: {
                        line: 91,
                        column: 69
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 91,
                        column: 33
                    },
                    end: {
                        line: 91,
                        column: 47
                    }
                }, {
                    start: {
                        line: 91,
                        column: 50
                    },
                    end: {
                        line: 91,
                        column: 69
                    }
                }],
                line: 91
            },
            '3': {
                loc: {
                    start: {
                        line: 93,
                        column: 4
                    },
                    end: {
                        line: 118,
                        column: 5
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 93,
                        column: 4
                    },
                    end: {
                        line: 118,
                        column: 5
                    }
                }, {
                    start: {
                        line: 93,
                        column: 4
                    },
                    end: {
                        line: 118,
                        column: 5
                    }
                }],
                line: 93
            },
            '4': {
                loc: {
                    start: {
                        line: 99,
                        column: 20
                    },
                    end: {
                        line: 99,
                        column: 77
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 99,
                        column: 40
                    },
                    end: {
                        line: 99,
                        column: 42
                    }
                }, {
                    start: {
                        line: 99,
                        column: 45
                    },
                    end: {
                        line: 99,
                        column: 77
                    }
                }],
                line: 99
            },
            '5': {
                loc: {
                    start: {
                        line: 126,
                        column: 26
                    },
                    end: {
                        line: 126,
                        column: 83
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 126,
                        column: 35
                    },
                    end: {
                        line: 126,
                        column: 61
                    }
                }, {
                    start: {
                        line: 126,
                        column: 64
                    },
                    end: {
                        line: 126,
                        column: 83
                    }
                }],
                line: 126
            },
            '6': {
                loc: {
                    start: {
                        line: 133,
                        column: 23
                    },
                    end: {
                        line: 135,
                        column: 41
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 134,
                        column: 14
                    },
                    end: {
                        line: 134,
                        column: 15
                    }
                }, {
                    start: {
                        line: 135,
                        column: 15
                    },
                    end: {
                        line: 135,
                        column: 40
                    }
                }],
                line: 133
            },
            '7': {
                loc: {
                    start: {
                        line: 151,
                        column: 4
                    },
                    end: {
                        line: 157,
                        column: 5
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 151,
                        column: 4
                    },
                    end: {
                        line: 157,
                        column: 5
                    }
                }, {
                    start: {
                        line: 151,
                        column: 4
                    },
                    end: {
                        line: 157,
                        column: 5
                    }
                }],
                line: 151
            },
            '8': {
                loc: {
                    start: {
                        line: 159,
                        column: 19
                    },
                    end: {
                        line: 161,
                        column: 79
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 160,
                        column: 11
                    },
                    end: {
                        line: 160,
                        column: 80
                    }
                }, {
                    start: {
                        line: 161,
                        column: 11
                    },
                    end: {
                        line: 161,
                        column: 78
                    }
                }],
                line: 159
            },
            '9': {
                loc: {
                    start: {
                        line: 160,
                        column: 11
                    },
                    end: {
                        line: 160,
                        column: 80
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 160,
                        column: 24
                    },
                    end: {
                        line: 160,
                        column: 51
                    }
                }, {
                    start: {
                        line: 160,
                        column: 54
                    },
                    end: {
                        line: 160,
                        column: 80
                    }
                }],
                line: 160
            },
            '10': {
                loc: {
                    start: {
                        line: 161,
                        column: 11
                    },
                    end: {
                        line: 161,
                        column: 78
                    }
                },
                type: 'cond-expr',
                locations: [{
                    start: {
                        line: 161,
                        column: 24
                    },
                    end: {
                        line: 161,
                        column: 50
                    }
                }, {
                    start: {
                        line: 161,
                        column: 53
                    },
                    end: {
                        line: 161,
                        column: 78
                    }
                }],
                line: 161
            },
            '11': {
                loc: {
                    start: {
                        line: 172,
                        column: 8
                    },
                    end: {
                        line: 177,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 172,
                        column: 8
                    },
                    end: {
                        line: 177,
                        column: 9
                    }
                }, {
                    start: {
                        line: 172,
                        column: 8
                    },
                    end: {
                        line: 177,
                        column: 9
                    }
                }],
                line: 172
            },
            '12': {
                loc: {
                    start: {
                        line: 178,
                        column: 8
                    },
                    end: {
                        line: 183,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 178,
                        column: 8
                    },
                    end: {
                        line: 183,
                        column: 9
                    }
                }, {
                    start: {
                        line: 178,
                        column: 8
                    },
                    end: {
                        line: 183,
                        column: 9
                    }
                }],
                line: 178
            },
            '13': {
                loc: {
                    start: {
                        line: 184,
                        column: 8
                    },
                    end: {
                        line: 189,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 184,
                        column: 8
                    },
                    end: {
                        line: 189,
                        column: 9
                    }
                }, {
                    start: {
                        line: 184,
                        column: 8
                    },
                    end: {
                        line: 189,
                        column: 9
                    }
                }],
                line: 184
            },
            '14': {
                loc: {
                    start: {
                        line: 190,
                        column: 8
                    },
                    end: {
                        line: 194,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 190,
                        column: 8
                    },
                    end: {
                        line: 194,
                        column: 9
                    }
                }, {
                    start: {
                        line: 190,
                        column: 8
                    },
                    end: {
                        line: 194,
                        column: 9
                    }
                }],
                line: 190
            },
            '15': {
                loc: {
                    start: {
                        line: 195,
                        column: 8
                    },
                    end: {
                        line: 199,
                        column: 9
                    }
                },
                type: 'if',
                locations: [{
                    start: {
                        line: 195,
                        column: 8
                    },
                    end: {
                        line: 199,
                        column: 9
                    }
                }, {
                    start: {
                        line: 195,
                        column: 8
                    },
                    end: {
                        line: 199,
                        column: 9
                    }
                }],
                line: 195
            }
        },
        s: {
            '0': 0,
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0,
            '5': 0,
            '6': 0,
            '7': 0,
            '8': 0,
            '9': 0,
            '10': 0,
            '11': 0,
            '12': 0,
            '13': 0,
            '14': 0,
            '15': 0,
            '16': 0,
            '17': 0,
            '18': 0,
            '19': 0,
            '20': 0,
            '21': 0,
            '22': 0,
            '23': 0,
            '24': 0,
            '25': 0,
            '26': 0,
            '27': 0,
            '28': 0,
            '29': 0,
            '30': 0,
            '31': 0,
            '32': 0,
            '33': 0,
            '34': 0,
            '35': 0,
            '36': 0,
            '37': 0,
            '38': 0,
            '39': 0,
            '40': 0,
            '41': 0,
            '42': 0,
            '43': 0,
            '44': 0,
            '45': 0,
            '46': 0,
            '47': 0,
            '48': 0,
            '49': 0
        },
        f: {
            '0': 0,
            '1': 0,
            '2': 0,
            '3': 0,
            '4': 0,
            '5': 0,
            '6': 0,
            '7': 0,
            '8': 0,
            '9': 0
        },
        b: {
            '0': [0, 0],
            '1': [0, 0],
            '2': [0, 0],
            '3': [0, 0],
            '4': [0, 0],
            '5': [0, 0],
            '6': [0, 0],
            '7': [0, 0],
            '8': [0, 0],
            '9': [0, 0],
            '10': [0, 0],
            '11': [0, 0],
            '12': [0, 0],
            '13': [0, 0],
            '14': [0, 0],
            '15': [0, 0]
        },
        _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
    },
        coverage = global[gcv] || (global[gcv] = {});

    if (coverage[path] && coverage[path].hash === hash) {
        return coverage[path];
    }

    coverageData.hash = hash;
    return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

// this is converting in/to coinselect format
//
// I am using the coinselect format, since the end-goal is
// to merge the changes back to upstream; it didn't work out so far


exports.coinselect = coinselect;

var _split = require('./coinselect-lib/outputs/split');

var _split2 = _interopRequireDefault(_split);

var _coinselectLib = require('./coinselect-lib');

var _coinselectLib2 = _interopRequireDefault(_coinselectLib);

var _utils = require('./coinselect-lib/utils');

var _bitcoinjsLibZcash = require('bitcoinjs-lib-zcash');

var _request = require('./request');

var request = _interopRequireWildcard(_request);

var _bchaddr = require('../utils/bchaddr');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var SEGWIT_INPUT_SCRIPT_LENGTH = (cov_2khk1ppals.s[0]++, 51); // actually 50.25, but let's make extra room
var INPUT_SCRIPT_LENGTH = (cov_2khk1ppals.s[1]++, 109);
var P2PKH_OUTPUT_SCRIPT_LENGTH = (cov_2khk1ppals.s[2]++, 25);
var P2SH_OUTPUT_SCRIPT_LENGTH = (cov_2khk1ppals.s[3]++, 23);
var P2WPKH_OUTPUT_SCRIPT_LENGTH = (cov_2khk1ppals.s[4]++, 22);
var P2WSH_OUTPUT_SCRIPT_LENGTH = (cov_2khk1ppals.s[5]++, 34);

function coinselect(utxos, rOutputs, height, feeRate, segwit, countMax, countMaxId, dustThreshold, network) {
    cov_2khk1ppals.f[0]++;

    var inputs = (cov_2khk1ppals.s[6]++, convertInputs(utxos, height, segwit));
    var outputs = (cov_2khk1ppals.s[7]++, convertOutputs(rOutputs, network));
    var options = (cov_2khk1ppals.s[8]++, {
        inputLength: segwit ? (cov_2khk1ppals.b[0][0]++, SEGWIT_INPUT_SCRIPT_LENGTH) : (cov_2khk1ppals.b[0][1]++, INPUT_SCRIPT_LENGTH),
        changeOutputLength: segwit ? (cov_2khk1ppals.b[1][0]++, P2SH_OUTPUT_SCRIPT_LENGTH) : (cov_2khk1ppals.b[1][1]++, P2PKH_OUTPUT_SCRIPT_LENGTH),
        dustThreshold: dustThreshold
    });

    var algorithm = (cov_2khk1ppals.s[9]++, countMax ? (cov_2khk1ppals.b[2][0]++, _split2.default) : (cov_2khk1ppals.b[2][1]++, _coinselectLib2.default));
    var result = (cov_2khk1ppals.s[10]++, algorithm(inputs, outputs, feeRate, options));
    cov_2khk1ppals.s[11]++;
    if (!result.inputs) {
        cov_2khk1ppals.b[3][0]++;
        cov_2khk1ppals.s[12]++;

        return {
            type: 'false'
        };
    } else {
        cov_2khk1ppals.b[3][1]++;

        var _fee = (cov_2khk1ppals.s[13]++, result.fee);
        var _max = (cov_2khk1ppals.s[14]++, countMaxId === -1 ? (cov_2khk1ppals.b[4][0]++, -1) : (cov_2khk1ppals.b[4][1]++, result.outputs[countMaxId].value));

        var _totalSpent = (cov_2khk1ppals.s[15]++, result.outputs.filter(function (output, i) {
            cov_2khk1ppals.f[1]++;
            cov_2khk1ppals.s[16]++;

            // change is always last and additional one
            return i !== rOutputs.length;
        }).map(function (o) {
            cov_2khk1ppals.f[2]++;
            cov_2khk1ppals.s[17]++;
            return o.value;
        }).reduce(function (a, b) {
            cov_2khk1ppals.f[3]++;
            cov_2khk1ppals.s[18]++;
            return a + b;
        }, 0) + result.fee);

        var allSize = (cov_2khk1ppals.s[19]++, (0, _utils.transactionBytes)(result.inputs, result.outputs));
        var _feePerByte = (cov_2khk1ppals.s[20]++, _fee / allSize);
        cov_2khk1ppals.s[21]++;
        return {
            type: 'true',
            result: _extends({}, result, {
                feePerByte: _feePerByte,
                bytes: allSize,
                max: _max,
                totalSpent: _totalSpent
            })
        };
    }
}

function convertInputs(inputs, height, segwit) {
    cov_2khk1ppals.f[4]++;

    var bytesPerInput = (cov_2khk1ppals.s[22]++, segwit ? (cov_2khk1ppals.b[5][0]++, SEGWIT_INPUT_SCRIPT_LENGTH) : (cov_2khk1ppals.b[5][1]++, INPUT_SCRIPT_LENGTH));
    cov_2khk1ppals.s[23]++;
    return inputs.map(function (input, i) {
        cov_2khk1ppals.f[5]++;
        cov_2khk1ppals.s[24]++;
        return {
            id: i,
            script: { length: bytesPerInput },
            value: input.value,
            own: input.own,
            coinbase: input.coinbase,
            confirmations: input.height == null ? (cov_2khk1ppals.b[6][0]++, 0) : (cov_2khk1ppals.b[6][1]++, 1 + height - input.height)
        };
    });
}

function isBech32(address) {
    cov_2khk1ppals.f[6]++;
    cov_2khk1ppals.s[25]++;

    try {
        cov_2khk1ppals.s[26]++;

        _bitcoinjsLibZcash.address.fromBech32(address);
        cov_2khk1ppals.s[27]++;
        return true;
    } catch (e) {
        cov_2khk1ppals.s[28]++;

        return false;
    }
}

function getScriptAddress(address, network) {
    cov_2khk1ppals.f[7]++;

    var bech = (cov_2khk1ppals.s[29]++, isBech32(address));
    var pubkeyhash = void 0;
    cov_2khk1ppals.s[30]++;
    if (!bech) {
        cov_2khk1ppals.b[7][0]++;

        var decoded = (cov_2khk1ppals.s[31]++, _bitcoinjsLibZcash.address.fromBase58Check((0, _bchaddr.convertCashAddress)(address)));
        cov_2khk1ppals.s[32]++;
        pubkeyhash = decoded.version === network.pubKeyHash;
    } else {
        cov_2khk1ppals.b[7][1]++;

        var _decoded = (cov_2khk1ppals.s[33]++, _bitcoinjsLibZcash.address.fromBech32(address));
        cov_2khk1ppals.s[34]++;
        pubkeyhash = _decoded.data.length === 20;
    }

    var length = (cov_2khk1ppals.s[35]++, bech ? (cov_2khk1ppals.b[8][0]++, pubkeyhash ? (cov_2khk1ppals.b[9][0]++, P2WPKH_OUTPUT_SCRIPT_LENGTH) : (cov_2khk1ppals.b[9][1]++, P2WSH_OUTPUT_SCRIPT_LENGTH)) : (cov_2khk1ppals.b[8][1]++, pubkeyhash ? (cov_2khk1ppals.b[10][0]++, P2PKH_OUTPUT_SCRIPT_LENGTH) : (cov_2khk1ppals.b[10][1]++, P2SH_OUTPUT_SCRIPT_LENGTH)));
    cov_2khk1ppals.s[36]++;
    return { length: length };
}

function convertOutputs(outputs, network) {
    cov_2khk1ppals.f[8]++;

    // most scripts are P2PKH; default is P2PKH
    var defaultScript = (cov_2khk1ppals.s[37]++, { length: P2PKH_OUTPUT_SCRIPT_LENGTH });
    cov_2khk1ppals.s[38]++;
    return outputs.map(function (output) {
        cov_2khk1ppals.f[9]++;
        cov_2khk1ppals.s[39]++;

        if (output.type === 'complete') {
            cov_2khk1ppals.b[11][0]++;
            cov_2khk1ppals.s[40]++;

            return {
                value: output.amount,
                script: getScriptAddress(output.address, network)
            };
        } else {
            cov_2khk1ppals.b[11][1]++;
        }
        cov_2khk1ppals.s[41]++;
        if (output.type === 'noaddress') {
            cov_2khk1ppals.b[12][0]++;
            cov_2khk1ppals.s[42]++;

            return {
                value: output.amount,
                script: defaultScript
            };
        } else {
            cov_2khk1ppals.b[12][1]++;
        }
        cov_2khk1ppals.s[43]++;
        if (output.type === 'opreturn') {
            cov_2khk1ppals.b[13][0]++;
            cov_2khk1ppals.s[44]++;

            return {
                value: 0,
                script: { length: 2 + output.dataHex.length / 2 }
            };
        } else {
            cov_2khk1ppals.b[13][1]++;
        }
        cov_2khk1ppals.s[45]++;
        if (output.type === 'send-max') {
            cov_2khk1ppals.b[14][0]++;
            cov_2khk1ppals.s[46]++;

            return {
                script: getScriptAddress(output.address, network)
            };
        } else {
            cov_2khk1ppals.b[14][1]++;
        }
        cov_2khk1ppals.s[47]++;
        if (output.type === 'send-max-noaddress') {
            cov_2khk1ppals.b[15][0]++;
            cov_2khk1ppals.s[48]++;

            return {
                script: defaultScript
            };
        } else {
            cov_2khk1ppals.b[15][1]++;
        }
        cov_2khk1ppals.s[49]++;
        throw new Error('WRONG-OUTPUT-TYPE');
    });
}